(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[6128],{33044:function(a,b,c){(window.__NEXT_P=window.__NEXT_P||[]).push(["/user/cart/payment",function(){return c(10605)}])},10605:function(a,b,c){"use strict";c.r(b);var d=c(28520),e=c.n(d),f=c(85893),g=c(27049),h=c(55241),i=c(11163),j=c(67294),k=c(87536),l=c(88767),m=c(72132),n=c(48880),o=c(61474),p=c(93702),q=c(9861),r=c(15755);function s(a,b,c,d,e,f,g){try{var h=a[f](g),i=h.value}catch(j){c(j);return}h.done?b(i):Promise.resolve(i).then(d,e)}function t(a,b,c){return b in a?Object.defineProperty(a,b,{value:c,enumerable:!0,configurable:!0,writable:!0}):a[b]=c,a}function u(a){for(var b=1;b<arguments.length;b++){var c=null!=arguments[b]?arguments[b]:{},d=Object.keys(c);"function"==typeof Object.getOwnPropertySymbols&&(d=d.concat(Object.getOwnPropertySymbols(c).filter(function(a){return Object.getOwnPropertyDescriptor(c,a).enumerable}))),d.forEach(function(b){t(a,b,c[b])})}return a}var v=function(){var a,b=(0,r.TL)(),c=(0,i.useRouter)(),d=(0,r.CG)(function(a){return a.cart.selectedShopIds}),p=(0,l.useQueryClient)(),t=(0,j.useState)(!1),v=t[0],w=t[1],x=(0,l.useQueries)(d.map(function(a){return{queryKey:["orderShopTempData",a],queryFn:function(){return n.c6.getByID(a).then(function(a){return a.Data})}}})).map(function(a){return a.data}),y=(0,l.useQuery)("userPayment",function(){var a;return n.EA.getByID(null===(a=x[0])|| void 0===a?void 0:a.UID)},{refetchOnWindowFocus:!1,enabled:!!(null===(a=x[0])|| void 0===a?void 0:a.UID)}).data,z=(0,q.Nj)({warehouseTQEnabled:!0,warehouseVNEnabled:!0,shippingTypeToWarehouseEnabled:!0}),A=z.warehouseTQ,B=z.warehouseVN,C=z.shippingTypeToWarehouse,D=(0,k.cI)({mode:"onBlur",defaultValues:{ShopPayments:x.map(function(a){return{ShopId:null==a?void 0:a.Id}})}}),E=D.control,F=D.handleSubmit,G=D.reset,H=D.getValues,I=D.setValue;(0,q.Hu)(function(){if(x.length&&(null==x?void 0:x[0])){var a=null==x?void 0:x[0],b=a.FullName,c=a.Address,d=a.Email,e=a.Phone;G({ReceiverFullName:b,ReceiverAddress:c,ReceiverEmail:d,ReceiverPhone:e,FullName:b,Address:c,Email:d,Phone:e,ShopPayments:x.map(function(a){return{ShopId:null==a?void 0:a.Id}})})}},[[C,A,B,x]]);var J=(0,l.useMutation)(n.c6.payment),K=function(a){return function(){var b=this,c=arguments;return new Promise(function(d,e){var f=a.apply(b,c);function g(a){s(f,d,e,g,h,"next",a)}function h(a){s(f,d,e,g,h,"throw",a)}g(void 0)})}}(e().mark(function a(f){var g,h,i,j,k,l;return e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(g=m.Am.loading("Đang xử l\xfd ..."),null==f?void 0:f.IsAgreement){a.next=4;break}return m.Am.warning("Vui l\xf2ng x\xe1c nhận trước khi thanh to\xe1n"),a.abrupt("return");case 4:for(i in h=H("ShopPayments"))void 0===H("ShopPayments")[i].WarehouseTQ&&I("ShopPayments.".concat(Number(i),".WarehouseTQ"),Number(null==y?void 0:null===(j=y.Data)|| void 0===j?void 0:j.WarehouseFrom)),void 0===H("ShopPayments")[i].WarehouseVN&&I("ShopPayments.".concat(Number(i),".WarehouseVN"),Number(null==y?void 0:null===(k=y.Data)|| void 0===k?void 0:k.WarehouseTo)),void 0===H("ShopPayments")[i].ShippingType&&I("ShopPayments.".concat(Number(i),".ShippingType"),Number(null==y?void 0:null===(l=y.Data)|| void 0===l?void 0:l.ShippingType));w(!0),J.mutateAsync(u({},f,{Address:H("Address")})).then(function(){p.invalidateQueries({queryKey:"menuData"}),c.push("/user/order-list"),d.map(function(a){return b((0,r.p6)(a))}),m.Am.update(g,{render:"Đặt đơn th\xe0nh c\xf4ng, đang v\xe0o giỏ h\xe0ng,",type:"success",autoClose:1000,isLoading:!1})}).catch(function(a){var b,c,d;m.Am.update(g,{render:null===(b=a)|| void 0===b?void 0:null===(c=b.response)|| void 0===c?void 0:null===(d=c.data)|| void 0===d?void 0:d.ResultMessage,type:"error",autoClose:1000,isLoading:!1}),w(!1)});case 8:case"end":return a.stop()}},a)})),L=x.map(function(a){return null==a?void 0:a.TotalPriceVND}),M=0;return L.forEach(function(a){M+=a}),(0,f.jsx)("div",{className:"",children:!!d.length&&!!(null==x?void 0:x[0])&&(0,f.jsx)(j.Fragment,{children:(0,f.jsxs)("div",{className:"grid grid-cols-12 gap-4",children:[(0,f.jsx)("div",{className:"col-span-12 lg:col-span-9 grid grid-cols-1 gap-4",children:x.map(function(a,b){return(0,f.jsxs)(j.Fragment,{children:[(0,f.jsx)(o.Efp,{index:b,orderShopTempData:a,warehouseVN:B,shippingTypeToWarehouse:C,warehouseTQ:A,userPayment:y,control:E}),(0,f.jsx)(g.Z,{})]},"".concat(b,"-").concat(null==a?void 0:a.Id))})}),window.innerWidth>=1024?(0,f.jsx)("div",{className:"col-span-3",children:(0,f.jsxs)("div",{className:"sticky top-4",children:[(0,f.jsx)(o.d1N,{control:E}),(0,f.jsx)(o.aWJ,{totalPrice:Number(M),control:E,loadingPayment:v,onPress:F(K)})]})}):(0,f.jsx)("div",{className:"fixed top-[77px] right-[15px]",children:(0,f.jsx)(h.Z,{placement:"bottomLeft",content:(0,f.jsxs)("div",{className:"p-4",children:[(0,f.jsx)(o.d1N,{control:E}),(0,f.jsx)(o.aWJ,{totalPrice:Number(M),control:E,loadingPayment:v,onPress:F(K)})]}),children:(0,f.jsx)(o.Kkx,{icon:"",title:"Tiếp tục đặt h\xe0ng",isButton:!0,isButtonClassName:"bg-green !text-white"})})})]})})})};v.displayName=p.W.shopping.payment,v.breadcrumb="Thanh to\xe1n",v.Layout=o.rfd,b.default=v}},function(a){a.O(0,[675,296,3662,7570,7281,9930,9774,2888,179],function(){return a(a.s=33044)}),_N_E=a.O()}])